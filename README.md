# 6DOF

## 1 Описание проекта

Данный проект создан для изучения возможностей [тренажёра](https://auto-sys.su/products/astm/) (зелёный), спроектированного на базе 6-ти степенной платформы Стюарта на угловых актуаторах.

![312683cc-cc83-4923-8dc0-b2953b33f5bf b5ASy](https://user-images.githubusercontent.com/86445241/231889804-f48c49f6-d8e7-466a-b50d-0ffda538c0c9.jpg)|![1  Graph, default position of platform](https://user-images.githubusercontent.com/86445241/231886267-50940a10-0ec4-424c-b39e-7f0f63999aef.png)
---|---
а). | б).  <br />

Рисунок 1 - тренажёр AST: а - тренажёр; б - схематичная визуализация результата расчёта (см. ветвь [visualization](https://github.com/LiDline/6DOF/tree/visualization)).

 Проект содержит 3 ветви:
1. main - реализация скрипта на python, возвращающего углы угловых актуаторов (редукторов) по заданным координатам и углам верхней платформы;
2. visualization - схематичная визуализация результата расчёта;
3. test - используемая в проекте теория по платформе.

## 2 Ветка main. Работа функции
main.py несёт в себе функцию:
```python
def solve(x, y, z, alpha, beta, gamma): # Example: (25, 25, 300, 5, 5, 5)
```
На вход подаётся 6 параметров:
- x - координата X (мм);
- y - координата Y (мм);
- z - координата Z (мм);
- alpha - угол OX (градусы);
- beta - угол OY (градусы);
- gamma - угол OZ (градусы). <br />

Результатом работы функции будет список из 6-ти НАИМЕНЬШИХ углов (относительно вертикальной оси OZ. OZ = 0 град) редукторов:
```python
return arm_angle # Example: [-55.88 -54.72 -92.84 -54.10 -58.97 -50.18] перевёл в градусы для удобства*
# На рисунке 2, а приведено значение угла для solve(25, 25, 300, 5, 5, 5)[0] (знаки углов разные, см. пункт 6).
```
Если заданные на входе параметры приведут к выходу за диапазон работы платформы, Вам вернут сообщение об этом (будет конкретно написано, какая часть платформы сломана). 

Допустимые диапазоны характеристик (находятся в constants.py):
- max угол шаровых = 35 град;
- min/max длина пружины (от шаровой до шаровой) = [464, 714] мм;
- max/min угол актуаторов = [-112.38, 52.62] град.

## 3 Состав ветки main
1. папка func - содержит в себе необходимые функции:
- cross_normal_to_oz.py - точки пересечения между окружностью (редуктором) и сферой (тяга). См. подробный разбор [тут](https://hedgedoc.auto-sys.su/JAqGGd3JRn-qmUJVMdjODg) или [тут](https://github.com/LiDline/6DOF/tree/test);
- matrix_1_4.py - запись получаемых координат XYZ (из cross_normal_to_oz.py) в ортогональных координатах (добавляем 1 в конец списка);
- rotation_matrix.py - реализация матрицы поворота по последовательности XYZ и запись её в ортогональных координатах (матрица 4х4);
- transition_matrix.py - матрица линейного переноса координат (матрица 4х4) - сюда записываем НА сколько перемещаемся;
2. папка SW - файлы SolidWorks 2020 со схемой(AST-5.2.0-A1-scetch.SLDASM) платформы для проверки (см. рисунок 1, а) получаемых углов шаровых опор актуаторов и уравновешивающих механизмов (менять углы/координаты верхней плиты необходимо через управляемые сопряжения, см. рисунок 1, б).
3. constants.py - файл с константами.
4. main.py - исполнительный файл.

## 3 Используемые библиотеки
...
____
Все используемые библиотеки python указаны в файле requirements.txt. Для быстрой установки отсутствующих библиотек в терминале выполните: 
```
pip install -r requirements.txt
```
## 4 Вариации использования скрипта

1. Изменить координаты точек крепления шаровых редукторов/пружин можно в матрицах в файле constants.py со строки 22.
2. Изменить допустимые диапазоны характеристик можно в файле constants.py со строки 11.

## 5 Проверка значений

1. Проверку полученных углов можно совершить в SW/AST-5.2.0-A1-scetch.SLDASM. Sketch "***Рычаг[i+1]***" = углу актуатора. На рисунке 2, а мы видим, что угол равен 55.88 град, что совпадает с solve(25, 25, 300, 5, 5, 5)[0] (знаки углов разные, см. пункт 6). 
2. В Sketch "***Угол шаровой[i+1]-1*** или ***2***" можно увидеть угол шаровой опоры.

![Проверка угла 0](https://user-images.githubusercontent.com/86445241/231896653-c5e6d8c8-8337-4123-a9c6-0ce3dfde19ac.png)|![Изменение положения](https://user-images.githubusercontent.com/86445241/231896717-9eafa52d-ff11-416e-bddb-7d6951c053db.png)
---|---
a).|б). <br />

Рисунок 2 - схема тренажера: а - угол нулевого актуатора = 55.88 град; б - способ изменения параметров. 

## 6 Определение углов
Введём локальную систему координат (далее СК) для определения углов. За ось поворота принимаем OZ (как в Matlab Simscape Multibody.  синяя линия рисунке 3, а). Ось OY (зелёная линия на рисунке 3, а) направлена на противоположную плиту. Ось OX (красная линия на рисунке 3, а) направлена на OX редуктора, расположенного в одной плоскости. <br />

### 6.1 Определение угла редуктора

Угол редуктора вычисляем относительно OY (рисунок 3, б). Важно отметить, что **в SW отрицательных углов нет**, в скрипте угол вычисляется через atan2: в I четверти знак положительный, во второй => отрицательный. Мы выбираем НАИМЕНЬШИЙ угол, который вписывается в диапазон max/min углов редукторов = [-112.38, 52.62] град (это конструкционные ограничения). <br />
См. подробный разбор нахождения углов [тут](https://hedgedoc.auto-sys.su/JAqGGd3JRn-qmUJVMdjODg) или [тут] в файле (https://github.com/LiDline/6DOF/tree/test) "**2. Sphere&circle.ipynb**".

![1](https://user-images.githubusercontent.com/86445241/232336460-858e7131-d233-469b-af6a-b62f14796a9e.png)|![2](https://user-images.githubusercontent.com/86445241/232336490-214af603-e1a8-474a-a9f0-af731c765a3b.png)
---|---
a).|б). <br />

Рисунок 2 - Определение угла редуктора: а - локальные СК для плит; б - определение угла редуктора в локальных СК.

### 6.2 Определение угла шаровой опоры

Для определения угла шаровой опоры на рычаге редуктора (файл leg_ball_corners.py) необходимо:

1. Найти координаты точки пересечения (см. рисунок 3, а) окружности (рычага редуктора) и сферы (тяги) и записать её в матричном виде.
2. Определим координаты верхней шаровой опоры тяги относительно точки пересечения путём перемножения обратной матрицы перемещений точки пересечения и матрицы координат верхней точки (строка 78).
3. Найдём угол между проекцией тяги (на локальной XY) и верхней точки (см. рисунок 3, б), чтобы повернуть локальную СК на полученный угол (строка 82). Создадим матрицу поворота из полученного угла и домножим её на матрицу из пункта 2 (строка 88).
4. Узнаем координаты верхней шаровой опоры тяги относительно точки пересечения в полученной СК путём перемножения обратной матрицы из пункта 3. на матрицу координат верхней точки (строка 97).
5. Находим угол (рисунок 3, в) через вычисление math.atan2(X, Z), где X и Z - координаты верхней точки из пункта 4 (строка 102).


![3](https://user-images.githubusercontent.com/86445241/232344811-bcad286f-bd7f-4143-a1cc-800e59a3b59f.png)|![4](https://user-images.githubusercontent.com/86445241/232344841-429eb999-e45e-46ed-a519-523b95f6f6db.png)|![5](https://user-images.githubusercontent.com/86445241/232344868-0b036978-341a-4664-9930-213f8e1f7be6.png)
---|---|---
a).|б).|в). <br />

Рисунок 2 - Определение угла шаровой опоры: а - точка пересечения окружности и сферы; б - угол между проекцией тяги (на локальной XY) и верхней точки; в - угол нижней шаровой опоры.<br />

Угол верхней шаровой опоры находится аналогичным способом.